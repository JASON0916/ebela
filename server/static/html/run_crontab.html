<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <title>订单数据</title>
    <link href="/static/css/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/bootstrap/css/bootstrap-datepicker.min.css" rel="stylesheet">
    <link href="/static/css/base.css" rel="stylesheet">
  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand">定时任务管理界面</a>
        </div>
      </div><!-- /.container-fluid -->
    </nav>

    <div class="container">
      <div class = "row">
      <!-- 查询框 -->
        <div class = "col-md-12">
          <form class="form-inline">
            <div class="query-group form-group">
              <label for="sdate">早餐定时任务:</label>
              <label for="sdate">时间:</label>
              <input type="text" class="form-date" id="start-date" name="sdate" > -
              <input type="text" class="form-date" id="end-date"  name="edate" >
            </div>


            <div class = "query-group form-group">
              <button type="button" class="btn btn-default" id="run_cron">执行</button>
            </div>
          </form>
        </div>
        <div class = "col-md-12">
          <form class="form-inline">
            <div class="query-group form-group">
              <label for="sdate">餐品评价定时任务:</label>
            </div>

            <div class = "query-group form-group">
              <button type="button" class="btn btn-default" id="run_dish_rating_cron">执行</button>
            </div>
      </form>
    </div>
      </div>
    </div>

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap/bootstrap.min.js"></script>
    <script src="/static/js/bootstrap/bootstrap-datepicker.min.js"></script>
    <script src="/static/js/bootstrap/bootstrap-datepicker.zh-CN.min.js"></script>
    <script src="/static/js/run_crontab.js"></script>
    <script>
        $(document).ready(function() {
            var date = new Date();
            date.setDate(date.getDate()-7);
            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();

            if (month < 10) month = "0" + month;
            if (day < 10) day = "0" + day;

            var today = year + "-" + month + "-" + day;
            $("#start-date").datepicker('setDate', today);
        });
        $(document).ready(function() {
            var date = new Date();
            date.setDate(date.getDate()-1);
            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();

            if (month < 10) month = "0" + month;
            if (day < 10) day = "0" + day;

            var today = year + "-" + month + "-" + day;
            $("#end-date").datepicker("setDate", today);
        });
        $('#start-date').datepicker({
            language: 'zh-CN',
            format: 'yyyy-mm-dd',
            autoclose: true,
            defaultDate: -7,
            startDate: '2015-04-29',
            endDate: '-1d',
            clearBtn: true
        }).on('changeDate', function(selected) {
            var minDate = new Date(selected.date.valueOf());
            $('#end-date').datepicker('setStartDate', minDate);
            var maxDate = new Date(selected.date.valueOf());
            maxDate.setDate(maxDate.getDate()+7);
            var nowDate = $('#end-date').datepicker('getDate');
            if(maxDate < nowDate) {
                $('#end-date').datepicker('setDate', maxDate);
            }
        }).on('clearDate', function(selected) {
            var yesterday = new Date();
            yesterday.setDate(yesterday.getDate()-1);
            $('#start-date').datepicker('setEndDate', yesterday);
            $('#start-date').datepicker('setStartDate', null);
            $('#end-date').datepicker('setEndDate', yesterday);
            $('#end-date').datepicker('setStartDate', null);
        });

        $('#end-date').datepicker({
            language: 'zh-CN',
            format: 'yyyy-mm-dd',
            autoclose: true,
            defaultDate: -1,
            endDate:'-1d',
            clearBtn: true
        }).on('changeDate', function(selected) {
            var minDate = new Date(selected.date.valueOf());
            minDate.setDate(minDate.getDate()-7);

            var nowDate = $('#start-date').datepicker('getDate');
            var maxDate = new Date(selected.date.valueOf());
            if(minDate > nowDate) {
                $('#start-date').datepicker('setEndDate', maxDate);
                $('#start-date').datepicker('setDate', minDate);
            }

            var right_date = $('#end-date').datepicker('getDate');
            $('#start-date').datepicker('setEndDate', right_date);

        }).on('clearDate', function(selected) {
            var yesterday = new Date();
            yesterday.setDate(yesterday.getDate()-1);
            $('#start-date').datepicker('setEndDate', yesterday);
            $('#start-date').datepicker('setStartDate', null);
            $('#end-date').datepicker('setEndDate', yesterday);
            $('#end-date').datepicker('setStartDate', null);
        });
    </script>
  </body>
</html>
